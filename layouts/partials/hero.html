{{- $hero := site.Data.hero -}}

{{- /* Process background image with WebP */ -}}
{{- $bgImage := resources.Get $hero.background_image -}}
{{- $bgUrlJpg := "" -}}
{{- $bgUrlWebp := "" -}}
{{- if $bgImage -}}
  {{- $bgUrlJpg = ($bgImage.Resize "1920x jpg q85").RelPermalink -}}
  {{- $bgUrlWebp = ($bgImage.Resize "1920x webp q85").RelPermalink -}}
{{- end -}}

{{- /* Process foreground image */ -}}
{{- $fgImage := resources.Get $hero.foreground_image -}}

<section class="hero hero-animate">
  {{- /* CSS custom properties for WebP background with fallback */ -}}
  <style>
    .hero {
      background-image: url('{{ $bgUrlJpg }}');
    }
    @supports (background-image: url('test.webp')) {
      .hero {
        background-image: url('{{ $bgUrlWebp }}');
      }
    }
  </style>

  {{- /* Foreground image with WebP and responsive srcset */ -}}
  {{- if $fgImage -}}
    {{- /* Generate WebP srcset */ -}}
    {{- $webpSrcset := slice -}}
    {{- $jpgSrcset := slice -}}
    {{- $widths := slice 500 800 1080 1600 1920 -}}
    {{- range $w := $widths -}}
      {{- $webp := $fgImage.Resize (printf "%dx webp q85" $w) -}}
      {{- $jpg := $fgImage.Resize (printf "%dx jpg q85" $w) -}}
      {{- $webpSrcset = $webpSrcset | append (printf "%s %dw" $webp.RelPermalink $w) -}}
      {{- $jpgSrcset = $jpgSrcset | append (printf "%s %dw" $jpg.RelPermalink $w) -}}
    {{- end -}}
  <picture class="hero__picture">
    <source
      type="image/webp"
      srcset="{{ delimit $webpSrcset ", " }}"
      sizes="100vw"
    >
    <img
      class="hero__image"
      src="{{ ($fgImage.Resize "1920x jpg q85").RelPermalink }}"
      srcset="{{ delimit $jpgSrcset ", " }}"
      sizes="100vw"
      alt="{{ $hero.image_alt }}"
      width="{{ $fgImage.Width }}"
      height="{{ $fgImage.Height }}"
      loading="eager"
      fetchpriority="high"
      decoding="async"
    >
  </picture>
  {{- end -}}

  {{- /* Content block */ -}}
  <div class="hero__content">
    <h1 class="hero__title">{{ $hero.title_line1 }}<br>{{ $hero.title_line2 }}</h1>
    <div class="hero__tagline tagline">
      {{- range $i, $line := $hero.tagline -}}
        {{- if $i }}<br>{{ end -}}
        {{ $line }}
      {{- end -}}
    </div>
    <div class="hero__cta">
      <a href="{{ $hero.cta.link }}" class="btn btn-secondary">{{ $hero.cta.text }}</a>
    </div>
  </div>
</section>
